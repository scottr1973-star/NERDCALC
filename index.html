<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NerdLab Calc v2 · Precision Calculator + Graphs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CDN (for utility classes) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js + math.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.js"></script>

  <style>
    body {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.08), rgba(15,23,42,0.98));
    }

    /* Small, subtle glow for cards and buttons */
    .fc-glow {
      box-shadow:
        0 0 0 1px rgba(148,163,184,0.15),
        0 8px 30px rgba(0,0,0,0.35),
        0 0 60px rgba(56,189,248,0.08);
    }

    .fc-card {
      background: rgba(2,6,23,0.72);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 24px;
    }

    .fc-card-soft {
      background: rgba(2,6,23,0.55);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(148,163,184,0.14);
      border-radius: 20px;
    }

    .calc-btn {
      background: rgba(15,23,42,0.78);
      border: 1px solid rgba(148,163,184,0.18);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.05),
        0 8px 18px rgba(0,0,0,0.35);
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out, filter 0.08s ease-out;
    }
    .calc-btn:hover {
      filter: brightness(1.08);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.06),
        0 10px 22px rgba(0,0,0,0.42),
        0 0 0 1px rgba(56,189,248,0.18);
      transform: translateY(-1px);
    }
    .calc-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.04),
        0 6px 14px rgba(0,0,0,0.38);
    }

    .calc-op {
      background: rgba(30,41,59,0.78);
      border: 1px solid rgba(148,163,184,0.20);
    }

    .calc-accent {
      background: linear-gradient(135deg, rgba(56,189,248,0.25), rgba(99,102,241,0.20));
      border: 1px solid rgba(56,189,248,0.25);
    }

    .calc-danger {
      background: linear-gradient(135deg, rgba(244,63,94,0.25), rgba(239,68,68,0.18));
      border: 1px solid rgba(244,63,94,0.25);
    }

    .calc-warn {
      background: linear-gradient(135deg, rgba(251,191,36,0.22), rgba(245,158,11,0.14));
      border: 1px solid rgba(251,191,36,0.22);
    }

    .soft-sep {
      border-top: 1px solid rgba(148,163,184,0.14);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      padding: 0.28rem 0.7rem;
      border-radius: 999px;
      background: rgba(2,6,23,0.55);
      border: 1px solid rgba(148,163,184,0.16);
      color: rgba(226,232,240,0.9);
      font-size: 0.75rem;
      letter-spacing: 0.02em;
    }

    /* Chart container makes canvas responsive */
    .chart-wrap {
      position: relative;
      width: 100%;
      height: 280px;
    }
    @media (min-width: 1024px) {
      .chart-wrap { height: 320px; }
    }

    /* Pretty thin scrollbar (Chrome/Edge/Safari) */
    .scrollbar-thin::-webkit-scrollbar {
      height: 6px;
      width: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: rgba(2,6,23,0.4);
      border-radius: 999px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: rgba(75,85,99,0.8);
      border-radius: 999px;
    }

    /* --- Mobile portrait overflow fix ---
       The UI is intentionally wide (two-panel layouts). Previously, overflow-x-hidden
       clipped the right side in portrait. We keep the layout identical, but allow
       horizontal scrolling when needed. Background glows stay clipped.
    */
    .flow-hscroll {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-x: contain;
    }

  </style>
  <style>
    /* FLUID SCALING for Mobile Portrait:
      Instead of a fixed pixel size, we use 'vw' (viewport width).
      2.5vw means the base size is 2.5% of the screen width.
      This forces the entire calculator to shrink proportionally 
      to fit exactly within the width of any phone screen.
    */
    @media (max-width: 480px) {
      html {
        font-size: 2.5vw; 
      }
    }
  </style>
</head>

<body class="min-h-screen text-slate-100 antialiased overflow-x-hidden">
  <div class="relative min-h-screen flex flex-col items-center px-0 py-4 md:px-6 md:py-8 overflow-x-auto flow-hscroll">
    <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
      <div class="absolute -top-40 -left-24 h-80 w-80 rounded-full bg-cyan-500/20 blur-3xl"></div>
      <div class="absolute top-40 -right-32 h-96 w-96 rounded-full bg-indigo-500/20 blur-3xl"></div>
      <div class="absolute bottom-0 left-1/2 -translate-x-1/2 h-72 w-[32rem] rounded-full bg-sky-400/10 blur-3xl"></div>
    </div>

    <header class="w-full max-w-6xl mb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between px-3 md:px-0">
      <div class="flex items-center gap-4">
        <div class="h-11 w-11 rounded-2xl bg-gradient-to-br from-sky-400 to-indigo-500 shadow-lg shadow-sky-500/40 flex items-center justify-center">
          <span class="font-mono font-bold text-xl text-slate-950">ƒ</span>
        </div>
        <div class="space-y-1">
          <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">
            NerdLab Calc <span class="text-sky-300/90">v2</span>
          </h1>
          <div class="flex flex-wrap gap-2">
            <span class="badge">
              <span class="inline-flex h-2.5 w-2.5 rounded-full bg-emerald-400 shadow-[0_0_10px_rgba(52,211,153,0.9)]"></span>
              Precision
            </span>
            <span class="badge">
              <span class="inline-flex h-1.5 w-1.5 rounded-full bg-sky-400 shadow-[0_0_6px_rgba(56,189,248,0.9)]"></span>
              Graphs
            </span>
            <span class="badge">
              <span class="inline-flex h-2 w-2 rounded-full bg-indigo-400 shadow-[0_0_10px_rgba(129,140,248,0.9)]"></span>
              Stats
            </span>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap gap-2">
        <button id="btn-reset" class="calc-btn px-4 py-2 rounded-xl text-sm font-semibold">
          Reset
        </button>
        <button id="btn-export" class="calc-btn px-4 py-2 rounded-xl text-sm font-semibold calc-accent">
          Export JSON
        </button>
      </div>
    </header>

    <main class="w-full max-w-6xl grid gap-4 md:grid-cols-[minmax(0,1.1fr)_minmax(0,1.2fr)] items-stretch px-1 md:px-0">
      <!-- LEFT: Calculator + History -->
      <section class="fc-card fc-glow p-3 md:p-5">
        <div class="flex flex-col gap-3">
          <div class="fc-card-soft p-3 md:p-4">
            <div class="flex items-start justify-between gap-3">
              <div class="space-y-1 min-w-0">
                <div class="text-xs uppercase tracking-widest text-slate-400">Display</div>
                <div id="main-display" class="w-full text-3xl md:text-4xl font-semibold tracking-tight leading-tight overflow-x-auto scrollbar-thin">
                  0
                </div>
              </div>
              <div class="flex flex-col items-end gap-1">
                <div class="badge">
                  <span class="inline-flex h-2 w-2 rounded-full bg-emerald-400 shadow-[0_0_10px_rgba(16,185,129,0.9)]"></span>
                  <span id="angle-mode">DEG</span>
                </div>
                <div class="badge">
                  <span class="inline-flex h-2 w-2 rounded-full bg-sky-400 shadow-[0_0_10px_rgba(56,189,248,0.9)]"></span>
                  <span id="precision-mode">Auto</span>
                </div>
              </div>
            </div>

            <div class="soft-sep my-3"></div>

            <div class="grid grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)] gap-2 md:gap-3 mt-2">
              <div class="grid grid-rows-[auto_1fr] gap-2">
                <div class="grid grid-cols-4 gap-1.5 text-xs">
                  <button data-key="mode-deg" class="calc-btn px-2 py-1.5 rounded-lg font-mono">DEG</button>
                  <button data-key="mode-rad" class="calc-btn px-2 py-1.5 rounded-lg font-mono opacity-70">RAD</button>
                  <button data-key="mode-clear" class="calc-btn px-2 py-1.5 rounded-lg font-mono text-rose-200">AC</button>
                  <button data-key="mode-del" class="calc-btn px-2 py-1.5 rounded-lg font-mono text-amber-200">DEL</button>
                </div>
                <div class="grid grid-cols-4 grid-rows-5 gap-1.5 text-base md:text-lg">
                  <button data-key="7" class="calc-btn rounded-xl py-3">7</button>
                  <button data-key="8" class="calc-btn rounded-xl py-3">8</button>
                  <button data-key="9" class="calc-btn rounded-xl py-3">9</button>
                  <button data-key="/" class="calc-btn calc-op rounded-xl py-3">÷</button>

                  <button data-key="4" class="calc-btn rounded-xl py-3">4</button>
                  <button data-key="5" class="calc-btn rounded-xl py-3">5</button>
                  <button data-key="6" class="calc-btn rounded-xl py-3">6</button>
                  <button data-key="*" class="calc-btn calc-op rounded-xl py-3">×</button>

                  <button data-key="1" class="calc-btn rounded-xl py-3">1</button>
                  <button data-key="2" class="calc-btn rounded-xl py-3">2</button>
                  <button data-key="3" class="calc-btn rounded-xl py-3">3</button>
                  <button data-key="-" class="calc-btn calc-op rounded-xl py-3">−</button>

                  <button data-key="0" class="calc-btn rounded-xl py-3">0</button>
                  <button data-key="." class="calc-btn rounded-xl py-3">.</button>
                  <button data-key="=" class="calc-btn calc-accent rounded-xl py-3 font-semibold">=</button>
                  <button data-key="+" class="calc-btn calc-op rounded-xl py-3">+</button>

                  <button data-key="(" class="calc-btn rounded-xl py-3">(</button>
                  <button data-key=")" class="calc-btn rounded-xl py-3">)</button>
                  <button data-key="%" class="calc-btn rounded-xl py-3">%</button>
                  <button data-key="^" class="calc-btn rounded-xl py-3">^</button>
                </div>
              </div>

              <div class="grid grid-rows-[auto_1fr] gap-2">
                <div class="grid grid-cols-2 gap-1.5 text-xs">
                  <button data-key="fn-sin" class="calc-btn px-2 py-1.5 rounded-lg font-mono">sin</button>
                  <button data-key="fn-cos" class="calc-btn px-2 py-1.5 rounded-lg font-mono">cos</button>
                  <button data-key="fn-tan" class="calc-btn px-2 py-1.5 rounded-lg font-mono">tan</button>
                  <button data-key="fn-log" class="calc-btn px-2 py-1.5 rounded-lg font-mono">log</button>
                </div>

                <div class="grid grid-cols-2 gap-1.5 text-sm">
                  <button data-key="fn-ln" class="calc-btn rounded-xl py-2 font-mono">ln</button>
                  <button data-key="fn-sqrt" class="calc-btn rounded-xl py-2 font-mono">√</button>

                  <button data-key="fn-abs" class="calc-btn rounded-xl py-2 font-mono">abs</button>
                  <button data-key="fn-pi" class="calc-btn rounded-xl py-2 font-mono">π</button>

                  <button data-key="fn-e" class="calc-btn rounded-xl py-2 font-mono">e</button>
                  <button data-key="fn-fact" class="calc-btn rounded-xl py-2 font-mono">x!</button>

                  <button data-key="fn-inv" class="calc-btn calc-warn rounded-xl py-2 font-mono">1/x</button>
                  <button data-key="fn-neg" class="calc-btn rounded-xl py-2 font-mono">±</button>

                  <button data-key="fn-rand" class="calc-btn rounded-xl py-2 font-mono">rand</button>
                  <button data-key="fn-mem" class="calc-btn rounded-xl py-2 font-mono">M+</button>

                  <button data-key="fn-mr" class="calc-btn rounded-xl py-2 font-mono">MR</button>
                  <button data-key="fn-mc" class="calc-btn calc-danger rounded-xl py-2 font-mono">MC</button>
                </div>
              </div>
            </div>
          </div>

          <div class="fc-card-soft p-3 md:p-4">
            <div class="flex items-center justify-between">
              <div class="text-xs uppercase tracking-widest text-slate-400">History</div>
              <div class="flex items-center gap-2">
                <span class="badge">
                  <span class="inline-flex h-2 w-2 rounded-full bg-violet-400 shadow-[0_0_10px_rgba(167,139,250,0.9)]"></span>
                  <span id="hist-count">0</span>
                </span>
                <button id="btn-clear-history" class="calc-btn px-3 py-1.5 rounded-xl text-xs font-semibold">
                  Clear
                </button>
              </div>
            </div>

            <div id="history-list" class="mt-3 max-h-44 md:max-h-56 overflow-y-auto scrollbar-thin space-y-2 pr-1">
              <!-- history items -->
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Graphs + Stats -->
      <section class="fc-card fc-glow p-3 md:p-5">
        <div class="flex flex-col gap-3">
          <div class="fc-card-soft p-3 md:p-4">
            <div class="flex items-center justify-between gap-3">
              <div class="space-y-1 min-w-0">
                <div class="text-xs uppercase tracking-widest text-slate-400">Graph</div>
                <div class="text-sm text-slate-300">
                  f(x) = <span id="graph-fx" class="font-mono text-sky-300">sin(x)</span>
                </div>
              </div>

              <div class="flex flex-wrap justify-end gap-2">
                <button id="btn-graph-sin" class="calc-btn px-3 py-1.5 rounded-xl text-xs font-semibold">sin</button>
                <button id="btn-graph-cos" class="calc-btn px-3 py-1.5 rounded-xl text-xs font-semibold">cos</button>
                <button id="btn-graph-tan" class="calc-btn px-3 py-1.5 rounded-xl text-xs font-semibold">tan</button>
                <button id="btn-graph-custom" class="calc-btn px-3 py-1.5 rounded-xl text-xs font-semibold calc-accent">custom</button>
              </div>
            </div>

            <div class="mt-3 chart-wrap">
              <canvas id="graph-canvas"></canvas>
            </div>

            <div class="mt-3 flex flex-col gap-2">
              <div class="text-xs uppercase tracking-widest text-slate-400">Domain</div>
              <div class="grid grid-cols-2 gap-2">
                <div class="fc-card-soft p-2">
                  <div class="text-xs text-slate-400">Min</div>
                  <input id="domain-min" type="number" value="-10"
                    class="w-full bg-transparent outline-none font-mono text-slate-200" />
                </div>
                <div class="fc-card-soft p-2">
                  <div class="text-xs text-slate-400">Max</div>
                  <input id="domain-max" type="number" value="10"
                    class="w-full bg-transparent outline-none font-mono text-slate-200" />
                </div>
              </div>

              <div class="flex items-center gap-2">
                <button id="btn-domain-apply" class="calc-btn px-4 py-2 rounded-xl text-sm font-semibold calc-accent">
                  Apply
                </button>
                <button id="btn-domain-reset" class="calc-btn px-4 py-2 rounded-xl text-sm font-semibold">
                  Reset
                </button>
              </div>
            </div>
          </div>

          <div class="fc-card-soft p-3 md:p-4">
            <div class="flex items-center justify-between">
              <div class="text-xs uppercase tracking-widest text-slate-400">Stats</div>
              <div class="badge">
                <span class="inline-flex h-2 w-2 rounded-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.9)]"></span>
                <span id="stats-mode">Session</span>
              </div>
            </div>

            <div class="mt-3 grid grid-cols-2 gap-2">
              <div class="fc-card-soft p-3">
                <div class="text-xs text-slate-400">Count</div>
                <div id="stat-count" class="text-lg font-semibold">0</div>
              </div>
              <div class="fc-card-soft p-3">
                <div class="text-xs text-slate-400">Mean</div>
                <div id="stat-mean" class="text-lg font-semibold">0</div>
              </div>
              <div class="fc-card-soft p-3">
                <div class="text-xs text-slate-400">Min</div>
                <div id="stat-min" class="text-lg font-semibold">0</div>
              </div>
              <div class="fc-card-soft p-3">
                <div class="text-xs text-slate-400">Max</div>
                <div id="stat-max" class="text-lg font-semibold">0</div>
              </div>
            </div>

            <div class="mt-3 soft-sep pt-3">
              <div class="text-xs uppercase tracking-widest text-slate-400 mb-2">Recent Results</div>
              <div id="recent-results" class="flex border border-slate-700/80 rounded-full bg-slate-950/80 p-1 overflow-x-auto scrollbar-thin">
                <!-- chips -->
              </div>
            </div>
          </div>

          <div class="fc-card-soft p-3 md:p-4">
            <div class="flex items-center justify-between">
              <div class="text-xs uppercase tracking-widest text-slate-400">Custom f(x)</div>
              <span class="badge">
                <span class="inline-flex h-2 w-2 rounded-full bg-cyan-400 shadow-[0_0_10px_rgba(34,211,238,0.9)]"></span>
                <span>y =</span>
              </span>
            </div>

            <div class="mt-3 flex flex-col gap-2">
              <input id="custom-fx" type="text" value="sin(x)"
                class="w-full bg-slate-950/60 border border-slate-700/70 rounded-xl px-3 py-2 font-mono text-sm outline-none focus:ring-2 focus:ring-sky-500/50" />
              <div class="flex items-center gap-2">
                <button id="btn-custom-apply" class="calc-btn px-4 py-2 rounded-xl text-sm font-semibold calc-accent">
                  Graph
                </button>
                <button id="btn-custom-help" class="calc-btn px-4 py-2 rounded-xl text-sm font-semibold">
                  Examples
                </button>
              </div>
              <div id="custom-help" class="hidden text-xs text-slate-400 leading-relaxed">
                Try: <span class="font-mono text-slate-200">x^2</span>,
                <span class="font-mono text-slate-200">sin(x)*x</span>,
                <span class="font-mono text-slate-200">log(abs(x)+1)</span>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="w-full max-w-6xl mt-4 text-xs text-slate-400 px-3 md:px-0">
      <div class="flex flex-wrap items-center justify-between gap-2">
        <div>
          <span class="text-slate-300 font-semibold">NerdLab</span> · Calc v2
        </div>
        <div class="flex items-center gap-2">
          <span class="badge">
            <span class="inline-flex h-2 w-2 rounded-full bg-green-400 shadow-[0_0_10px_rgba(74,222,128,0.9)]"></span>
            <span>Math: <span class="text-emerald-300">math.js</span> · Graph: <span class="text-sky-300">Chart.js</span></span>
          </span>
          <span class="badge">
            <span class="inline-flex h-2 w-2 rounded-full bg-fuchsia-400 shadow-[0_0_10px_rgba(232,121,249,0.9)]"></span>
            <span>UI: Tailwind</span>
          </span>
        </div>
      </div>
    </footer>
  </div>

  <script src="nerdlab-calc.js"></script>
</body>
</html>
