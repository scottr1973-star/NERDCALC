<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NerdLab Calc v2 · Ultimate Nerd Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['system-ui','-apple-system','SF Pro Text','Inter','sans-serif'],
            mono: ['JetBrains Mono','SF Mono','ui-monospace','Menlo','monospace'],
          }
        }
      }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.js"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: #e5e7eb;
    }
    .fc-card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.08), rgba(15,23,42,0.98));
      border-radius: 1.25rem;
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow: 0 24px 60px rgba(15,23,42,0.9), 0 0 32px rgba(59,130,246,0.28);
      backdrop-filter: blur(24px);
    }
    .fc-card-soft {
      background: radial-gradient(circle at top left, rgba(148,163,184,0.06), rgba(15,23,42,0.97));
      border-radius: 1.25rem;
      border: 1px solid rgba(51,65,85,0.9);
      box-shadow: 0 18px 40px rgba(15,23,42,0.9), 0 0 24px rgba(59,130,246,0.18);
      backdrop-filter: blur(20px);
    }
    .fc-pill {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.95));
      box-shadow: 0 12px 30px rgba(15,23,42,0.9);
    }
    .calc-btn-main {
      background: radial-gradient(circle at top, #38bdf8, #2563eb 48%, #111827 100%);
      border: 1px solid rgba(191,219,254,0.85);
      box-shadow: 0 16px 36px rgba(15,23,42,1), 0 0 18px rgba(56,189,248,0.9);
      color: #020617;
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out;
    }
    .calc-btn-main:active { transform: translateY(1px) scale(0.98); }
    .calc-btn {
      background: radial-gradient(circle at top, #111827, #020617 60%, #020617 100%);
      border: 1px solid rgba(30,64,175,0.9);
      color: #e5e7eb;
      transition: transform 0.08s ease-out;
    }
    .calc-btn:active { transform: translateY(1px) scale(0.98); }
    .tab-pill { border-radius: 999px; transition: all 0.16s ease-out; cursor: pointer; white-space: nowrap; font-size: 0.75rem; }
    .tab-pill-active { border-color: rgba(96,165,250,0.9); background: rgba(59,130,246,0.25); color: #e5e7eb; }
    .tab-pill-inactive { color: #9ca3af; }
    
    /* Responsive Scale Fix */
    @media (max-width: 480px) {
      html { font-size: 2.5vw; }
      .main-grid { grid-template-columns: 1fr !important; }
    }
  </style>
</head>

<body class="min-h-screen text-slate-100 antialiased overflow-x-hidden p-2 md:p-6">
  <div class="max-w-6xl mx-auto space-y-4">
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-sky-400 to-blue-700 flex items-center justify-center font-bold text-slate-950">ƒ</div>
        <h1 class="text-xl font-bold">NerdLab v2</h1>
      </div>
      <div class="fc-pill px-4 py-1 text-xs font-mono uppercase tracking-widest text-emerald-400">Core: Math.js</div>
    </header>

    <main class="main-grid grid grid-cols-[1.1fr_1.2fr] gap-4">
      <section class="fc-card p-4 space-y-4">
        <div class="flex justify-between text-[10px] font-mono text-slate-400">
            <div id="angle-mode-pill" class="bg-slate-900 px-2 py-0.5 rounded border border-slate-700">RAD</div>
            <div id="status-line">Ready.</div>
        </div>
        <div class="bg-slate-950/80 border border-slate-700 rounded-xl p-4 text-right">
            <div id="expression-display" class="text-xs text-slate-500 font-mono h-4"></div>
            <div id="main-display" class="text-4xl font-mono truncate">0</div>
        </div>
        
        <div class="grid grid-cols-4 gap-2">
            <button data-key="mode-clear" class="calc-btn p-3 rounded-lg text-rose-400">AC</button>
            <button data-key="mode-del" class="calc-btn p-3 rounded-lg">DEL</button>
            <button data-func="ans" class="calc-btn p-3 rounded-lg text-sky-400">ANS</button>
            <button data-op="÷" class="calc-btn p-3 rounded-lg text-sky-400">÷</button>
            
            <button data-key="7" class="calc-btn p-3 rounded-lg">7</button>
            <button data-key="8" class="calc-btn p-3 rounded-lg">8</button>
            <button data-key="9" class="calc-btn p-3 rounded-lg">9</button>
            <button data-op="×" class="calc-btn p-3 rounded-lg text-sky-400">×</button>
            
            <button data-key="4" class="calc-btn p-3 rounded-lg">4</button>
            <button data-key="5" class="calc-btn p-3 rounded-lg">5</button>
            <button data-key="6" class="calc-btn p-3 rounded-lg">6</button>
            <button data-op="-" class="calc-btn p-3 rounded-lg text-sky-400">−</button>
            
            <button data-key="1" class="calc-btn p-3 rounded-lg">1</button>
            <button data-key="2" class="calc-btn p-3 rounded-lg">2</button>
            <button data-key="3" class="calc-btn p-3 rounded-lg">3</button>
            <button data-op="+" class="calc-btn p-3 rounded-lg text-sky-400">+</button>
            
            <button data-key="0" class="calc-btn p-3 rounded-lg">0</button>
            <button data-key="." class="calc-btn p-3 rounded-lg">.</button>
            <button data-key="(" class="calc-btn p-3 rounded-lg">(</button>
            <button data-eval="=" class="calc-btn-main p-3 rounded-lg font-bold">=</button>
        </div>
      </section>

      <section class="fc-card-soft p-4 flex flex-col gap-4">
        <div class="flex gap-2 overflow-x-auto pb-2 border-b border-slate-800">
            <button class="tab-pill tab-pill-active px-4 py-1" data-tab-target="console">Console</button>
            <button class="tab-pill tab-pill-inactive px-4 py-1" data-tab-target="graph">Graph</button>
            <button class="tab-pill tab-pill-inactive px-4 py-1" data-tab-target="matrix">Matrix</button>
            <button class="tab-pill tab-pill-inactive px-4 py-1" data-tab-target="solve">Solve</button>
        </div>

        <div id="tab-content" class="flex-1">
            <div id="tab-console" class="space-y-4">
                <textarea id="consoleInput" class="w-full h-32 bg-slate-900 border border-slate-700 rounded-lg p-3 font-mono text-sm" placeholder="a = 5&#10;b = 10&#10;sqrt(a^2 + b^2)"></textarea>
                <button onclick="runConsole()" class="bg-sky-600 px-4 py-2 rounded-lg text-sm">Run Expression</button>
                <pre id="consoleOutput" class="bg-black p-3 rounded-lg text-emerald-400 font-mono text-xs min-h-[50px]"></pre>
            </div>

            <div id="tab-graph" class="hidden space-y-4">
                <input id="graphExpr" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-2" placeholder="sin(x) * x">
                <button onclick="plotGraph()" class="bg-sky-600 px-4 py-2 rounded-lg text-sm">Plot</button>
                <div class="h-48 bg-slate-950 rounded-lg"><canvas id="graphCanvas"></canvas></div>
            </div>

            <div id="tab-matrix" class="hidden space-y-4">
                <textarea id="matrixA" class="w-full h-24 bg-slate-900 border border-slate-700 rounded-lg p-2 font-mono text-xs" placeholder="[1, 2]&#10;[3, 4]"></textarea>
                <button onclick="matrixDet()" class="bg-violet-600 px-4 py-2 rounded-lg text-xs">Determinant</button>
                <pre id="matrixOutput" class="bg-black p-2 rounded text-xs text-emerald-400"></pre>
            </div>

            <div id="tab-solve" class="hidden space-y-4">
                <div class="text-xs text-slate-400">Newton's Method Root Finder</div>
                <input id="solveRootExpr" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-2" placeholder="x^2 - 2">
                <button onclick="solveRoot()" class="bg-emerald-600 px-4 py-2 rounded-lg text-sm">Find Root</button>
                <pre id="solveRootOutput" class="bg-black p-2 rounded text-xs text-emerald-400"></pre>
            </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // CORE LOGIC
    let expression = "";
    let display = "0";
    let ans = 0;

    const mainEl = document.getElementById('main-display');
    const exprEl = document.getElementById('expression-display');
    const statusEl = document.getElementById('status-line');

    function updateUI() {
        mainEl.textContent = display || "0";
        exprEl.textContent = expression;
    }

    document.querySelectorAll('[data-key]').forEach(btn => {
        btn.addEventListener('click', () => {
            const val = btn.dataset.key;
            if (val === 'mode-clear') { expression = ""; display = "0"; }
            else if (val === 'mode-del') { expression = expression.slice(0, -1); display = expression; }
            else { expression += val; display = expression; }
            updateUI();
        });
    });

    document.querySelectorAll('[data-op]').forEach(btn => {
        btn.addEventListener('click', () => {
            const op = btn.dataset.op.replace('×', '*').replace('÷', '/');
            expression += op;
            display = expression;
            updateUI();
        });
    });

    document.querySelector('[data-eval="="]').addEventListener('click', () => {
        try {
            ans = math.evaluate(expression || "0", { ans });
            display = ans.toString();
            expression = "";
            updateUI();
        } catch (e) {
            statusEl.textContent = "Error";
            setTimeout(() => statusEl.textContent = "Ready.", 2000);
        }
    });

    // WORKBENCH LOGIC
    function runConsole() {
        const input = document.getElementById('consoleInput').value;
        const out = document.getElementById('consoleOutput');
        try {
            const result = math.evaluate(input, { ans });
            out.textContent = result.toString();
        } catch (e) { out.textContent = "Error: " + e.message; }
    }

    let graphChart = null;
    function plotGraph() {
        const expr = document.getElementById('graphExpr').value;
        const ctx = document.getElementById('graphCanvas').getContext('2d');
        const xValues = math.range(-10, 10, 0.5).toArray();
        const yValues = xValues.map(x => {
            try { return math.evaluate(expr, { x }); } catch(e) { return null; }
        });

        if (graphChart) graphChart.destroy();
        graphChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: xValues,
                datasets: [{ label: 'f(x)', data: yValues, borderColor: '#38bdf8', tension: 0.4 }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    function matrixDet() {
        const input = document.getElementById('matrixA').value;
        const out = document.getElementById('matrixOutput');
        try {
            const m = math.evaluate(input);
            out.textContent = "det = " + math.det(m);
        } catch(e) { out.textContent = "Invalid Matrix"; }
    }

    function solveRoot() {
        const expr = document.getElementById('solveRootExpr').value;
        const out = document.getElementById('solveRootOutput');
        try {
            // Simple Newton's Approximation
            let x = 1.0;
            for(let i=0; i<10; i++) {
                let f = math.evaluate(expr, { x });
                let df = (math.evaluate(expr, { x: x + 0.001 }) - f) / 0.001;
                x = x - f/df;
            }
            out.textContent = "Root ≈ " + x.toFixed(6);
        } catch(e) { out.textContent = "Error solving"; }
    }

    // Tab Switching
    document.querySelectorAll('[data-tab-target]').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tab-pill').forEach(p => p.classList.replace('tab-pill-active', 'tab-pill-inactive'));
            tab.classList.replace('tab-pill-inactive', 'tab-pill-active');
            document.querySelectorAll('#tab-content > div').forEach(div => div.classList.add('hidden'));
            document.getElementById('tab-' + tab.dataset.tabTarget).classList.remove('hidden');
        });
    });
  </script>
</body>
</html>
